OTA UPDATE AUTOMATION – FLOW CHART
=================================

 ┌──────────────────────────────┐
 │        START SCRIPT          │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │       Preflight Checks       │
 │  (Admin, Packages, Store,   │
 │   Build Folder, MSIX files) │
 └──────────────┬───────────────┘
                │
        ┌───────▼────────┐
        │ Checks Passed? │
        └───────┬────────┘
            NO ──┘
            │
            ▼
       ┌───────────┐
       │   EXIT     │
       └───────────┘

            YES
             │
             ▼
 ┌──────────────────────────────┐
 │ Install Old HP MSIX Build    │
 └──────────────┬───────────────┘
                │
        ┌───────▼────────┐
        │ Install OK ?   │
        └───────┬────────┘
            NO ──┘
            │
            ▼
       ┌───────────┐
       │   EXIT     │
       └───────────┘

            YES
             │
             ▼
 ┌──────────────────────────────┐
 │ Launch HP App                │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ Get Old HP Prod Version      │
 └──────────────┬───────────────┘
                │
        ┌───────▼────────┐
        │ Valid Prod ?   │
        └───────┬────────┘
            NO ──┘
            │
            ▼
       ┌───────────┐
       │   EXIT     │
       └───────────┘

            YES
             │
             ▼
 ┌──────────────────────────────┐
 │ Close HP App                 │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ Launch Microsoft Store       │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ Open Downloads Page          │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ Select HP App in Downloads   │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ update_until_done()          │
 │ (Monitor Update / Retry)     │
 └──────────────┬───────────────┘
                │
                ▼
     ┌─────────────────────────────┐
     │ Is "Update" or "Retry"?     │
     └──────────────┬──────────────┘
              YES ──┘
               │
               ▼
        ┌──────────────────┐
        │ Click Update     │
        │ / Retry          │
        └───────┬──────────┘
                │
                ▼
        ┌──────────────────┐
        │ Open Button Seen │
        └───────┬──────────┘
            YES ─┘
             │
             ▼
      ┌───────────────────┐
      │ Update Completed  │
      └─────────┬─────────┘
                │
                ▼
         ┌────────────────┐
         │ EXIT UPDATE     │
         └────────────────┘


            NO UPDATE / RETRY
                    │
                    ▼
        ┌──────────────────────────┐
        │ Recovery #1 (20 sec)     │
        │ Open Downloads + HP App  │
        └──────────────┬───────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │ Recovery #2 (60 sec)     │
        │ Open Downloads + HP App  │
        └──────────────┬───────────┘
                       │
                       ▼
        ┌──────────────────────────┐
        │ Recovery #3 (Build Check)│
        └──────────────┬───────────┘
                       │
               ┌───────▼────────┐
               │ Build Changed? │
               └───────┬────────┘
                   NO ─┘
                   │
                   ▼
     ┌──────────────────────────────┐
     │ Return "RESTART_STORE"       │
     └──────────────┬───────────────┘
                    │
                    ▼
     ┌──────────────────────────────┐
     │ Close Microsoft Store        │
     └──────────────┬───────────────┘
                    │
                    ▼
     ┌──────────────────────────────┐
     │ Relaunch Store & Retry OTA   │
     └──────────────┬───────────────┘
                    │
                    ▼
              (update_until_done again)


                   YES
                    │
                    ▼
     ┌──────────────────────────────┐
     │ Return "UPDATED"             │
     └──────────────┬───────────────┘
                    │
                    ▼
 ┌──────────────────────────────┐
 │ Close MS Store & HP App      │
 └──────────────┬───────────────┘
                │
                ▼
 ┌──────────────────────────────┐
 │ Get New HP Build Version     │
 └──────────────┬───────────────┘
                │
        ┌───────▼────────┐
        │ New > Old ?    │
        └───────┬────────┘
            NO ──┘
            │
            ▼
 ┌──────────────────────────────┐
 │ OTA Validation FAILED        │
 └──────────────────────────────┘
            YES
             │
             ▼
 ┌──────────────────────────────┐
 │ OTA Update SUCCESSFUL        │
 └──────────────────────────────┘
                │
                ▼
           ┌──────────┐
           │   END    │
           └──────────┘
